<!DOCTYPE html>
<html lang="nn">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Interaktivt kart: Noreg ‚Äì fylke og st√∏rste byar</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
  <style>
    :root{--ink:#0e1726;--muted:#5b6786;--accent:#2563eb}
    html,body{height:100%; margin:0}
    body{font:16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans", Arial; color:var(--ink);}
    header{padding:12px 16px; border-bottom:1px solid #e5e7eb; display:flex; align-items:center; justify-content:space-between}
    h1{font-size:18px; margin:0}
    .wrap{display:grid; grid-template-columns: 320px 1fr; height:calc(100% - 54px)}
    @media (max-width: 900px){.wrap{grid-template-columns:1fr; grid-template-rows:260px 1fr}}
    aside{border-right:1px solid #e5e7eb; padding:12px; overflow:auto}
    #map{height:100%; width:100%}
    .box{background:#f8fafc; border:1px solid #e5e7eb; border-radius:12px; padding:10px; margin-bottom:12px}
    .box h2{font-size:15px; margin:0 0 6px}
    .hint{font-size:12px; color:var(--muted)}
    .list{display:grid; gap:8px; max-height:240px; overflow:auto}
    .item{display:flex; justify-content:space-between; align-items:center; gap:8px; background:white; border:1px solid #e5e7eb; border-radius:10px; padding:8px 10px; cursor:pointer}
    .item:hover{border-color:#cbd5e1; background:#f9fafb}
    .tag{font-size:11px; color:white; background:#334155; padding:2px 8px; border-radius:999px}
    .legend{display:flex; gap:8px; flex-wrap:wrap; font-size:12px}
    .legend span{display:inline-flex; align-items:center; gap:6px}
    .dot{width:10px; height:10px; border-radius:50%}
    .city{background:#ef4444}
    .county{background:#2563eb}
    .border{background:transparent; border:2px solid #2563eb}
    .controls{display:flex; gap:8px; flex-wrap:wrap}
    .btn{all:unset; cursor:pointer; padding:8px 10px; border-radius:10px; border:1px solid #e5e7eb; background:white}
    .btn:hover{background:#f8fafc}
    input[type="search"]{width:100%; padding:10px 12px; border-radius:10px; border:1px solid #e5e7eb}
  </style>
</head>
<body>
  <header>
    <h1>Interaktivt kart: Noreg ‚Äì fylke og st√∏rste byar</h1>
    <div class="controls">
      <button class="btn" id="fitNO">üîé Zoom til Noreg</button>
      <button class="btn" id="toggleCities">Byar p√•/av</button>
      <button class="btn" id="toggleCounties">Fylke (punkt) p√•/av</button>
      <button class="btn" id="toggleBorders">Grenser p√•/av</button>
    </div>
  </header>
  <div class="wrap">
    <aside>
      <div class="box">
        <h2>S√∏k</h2>
        <input id="q" type="search" placeholder="S√∏k by eller fylke‚Ä¶ (t.d. Bergen, Agder)" />
        <div class="hint">Trykk p√• eit treff i lista for √• zoome</div>
      </div>
      <div class="box">
        <h2>Fylke (2024 ‚Üí )</h2>
        <div id="countyList" class="list"></div>
      </div>
      <div class="box">
        <h2>St√∏rste byar</h2>
        <div id="cityList" class="list"></div>
      </div>
      <div class="legend box">
        <span><span class="dot county"></span> Fylkesmark√∏r</span>
        <span><span class="dot city"></span> Bymark√∏r</span>
        <span><span class="dot border"></span> Fylkesgrenser</span>
      </div>
      <div class="hint">Datapunkta er forenkla for undervisning (5. trinn). Fylkesgrenser fr√• Geonorge/Kartverket (CC BY 4.0).</div>
    </aside>
    <div id="map"></div>
  </div>

  <script>
    // Enkelt feillogging
    window.addEventListener('error', e => console.error('JS-feil:', e.message));

    // Oppstart av kart
    const map = L.map('map', { zoomControl: true }).setView([64.6, 12.0], 4.8);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 18,
      attribution: '&copy; OpenStreetMap-bidragsytarar'
    }).addTo(map);

    const fitNorway = () => map.fitBounds([[57.9, 4.0],[71.5, 31.3]]);
    fitNorway();

    // Forenkla sentrumspunkt for fylke ‚Äì med areal
    const counties = [
      {name:'Agder', lat:58.845, lon:7.624, area:'16 434 km¬≤'},
      {name:'Akershus', lat:60.02, lon:11.2, area:'5 191 km¬≤'},
      {name:'Buskerud', lat:60.53, lon:8.5, area:'14 911 km¬≤'},
      {name:'Finnmark', lat:70.0, lon:24.65, area:'48 618 km¬≤'},
      {name:'Innlandet', lat:61.2, lon:10.6, area:'52 113 km¬≤'},
      {name:'M√∏re og Romsdal', lat:62.85, lon:7.5, area:'13 816 km¬≤'},
      {name:'Nordland', lat:66.9, lon:14.8, area:'38 480 km¬≤'},
      {name:'Oslo', lat:59.9139, lon:10.7522, area:'454 km¬≤'},
      {name:'Rogaland', lat:58.95, lon:6.0, area:'9 376 km¬≤'},
      {name:'Telemark', lat:59.35, lon:8.6, area:'15 299 km¬≤'},
      {name:'Troms', lat:69.2, lon:19.1, area:'25 877 km¬≤'},
      {name:'Tr√∏ndelag', lat:63.9, lon:10.4, area:'41 258 km¬≤'},
      {name:'Vestfold', lat:59.35, lon:10.2, area:'2 166 km¬≤'},
      {name:'Vestland', lat:60.9, lon:6.2, area:'33 871 km¬≤'},
      {name:'√òstfold', lat:59.3, lon:11.3, area:'4 183 km¬≤'}
    ];
    const areaByName = Object.fromEntries(counties.map(c => [c.name, c.area]));

    // Nokre store byar
    const cities = [
      {name:'Oslo', lat:59.9139, lon:10.7522, pop:'~1 064 000 (metropol)'},
      {name:'Bergen', lat:60.39299, lon:5.32415, pop:'~290 000'},
      {name:'Trondheim', lat:63.4305, lon:10.3951, pop:'~220 000'},
      {name:'Stavanger', lat:58.96998, lon:5.73311, pop:'~145 000'},
      {name:'Sandnes', lat:58.8524, lon:5.7352, pop:'~85 000'},
      {name:'Drammen', lat:59.7439, lon:10.2045, pop:'~105 000'},
      {name:'Fredrikstad', lat:59.2181, lon:10.9298, pop:'~85 000'},
      {name:'Sarpsborg', lat:59.2839, lon:11.1096, pop:'~58 000'},
      {name:'Kristiansand', lat:58.1467, lon:7.9956, pop:'~115 000'},
      {name:'Troms√∏', lat:69.6492, lon:18.9553, pop:'~78 000'},
      {name:'Bod√∏', lat:67.28, lon:14.405, pop:'~55 000'},
      {name:'√Ölesund', lat:62.4722, lon:6.1495, pop:'~67 000'},
      {name:'Skien', lat:59.2096, lon:9.608, pop:'~56 000'},
      {name:'Porsgrunn', lat:59.1407, lon:9.6561, pop:'~37 000'}
    ];

    // Lag (layers)
    const countyLayer = L.layerGroup();
    const cityLayer = L.layerGroup();
    const borderLayer = L.layerGroup();

    // Enkle prikksymbol
    const countyIcon = L.divIcon({className:'', html:'<div style="width:14px;height:14px;border-radius:50%;background:#2563eb;border:2px solid white;box-shadow:0 0 0 2px rgba(37,99,235,.25)"></div>', iconSize:[14,14], iconAnchor:[7,7]});
    const cityIcon   = L.divIcon({className:'', html:'<div style="width:14px;height:14px;border-radius:50%;background:#ef4444;border:2px solid white;box-shadow:0 0 0 2px rgba(239,68,68,.25)"></div>', iconSize:[14,14], iconAnchor:[7,7]});

    // Lister i sidepanelet
    const countyList = document.getElementById('countyList');
    const cityList = document.getElementById('cityList');

    function addListItem(container, label, tag, onClick){
      const el = document.createElement('div');
      el.className = 'item';
      el.innerHTML = `<span>${label}</span><span class="tag">${tag}</span>`;
      el.addEventListener('click', onClick);
      container.appendChild(el);
    }

    // Marker: fylke (viser areal i popup)
    counties.forEach(c => {
      const m = L.marker([c.lat, c.lon], {icon: countyIcon}).addTo(countyLayer)
        .bindPopup(`<b>${c.name}</b><br/>Areal: ${c.area}`);
      m.on('click', ()=> map.setView([c.lat, c.lon], 7));
      addListItem(countyList, c.name, 'Fylke', ()=>{ map.setView([c.lat, c.lon], 7); m.openPopup(); });
    });

    // Marker: byar
    cities.forEach(c => {
      const m = L.marker([c.lat, c.lon], {icon: cityIcon}).addTo(cityLayer)
        .bindPopup(`<b>${c.name}</b><br/>By i Noreg${c.pop?`<br/>Folketal: ${c.pop}`:''}`);
      m.on('click', ()=> map.setView([c.lat, c.lon], 9));
      addListItem(cityList, c.name, 'By', ()=>{ map.setView([c.lat, c.lon], 9); m.openPopup(); });
    });

    // Sl√• p√• lag
    countyLayer.addTo(map);
    cityLayer.addTo(map);

    // Fylkesgrenser (GeoJSON) ‚Äì open kjelde
    fetch('https://raw.githubusercontent.com/robhop/fylker-og-kommuner/main/Fylker-M.geojson')
      .then(r => r.json())
      .then(geo => {
        L.geoJSON(geo, {
          style:{color:'#2563eb', weight:1.2, fillOpacity:0.03},
          onEachFeature: (feat, layer)=>{
            // Finn namn fr√• eigenskapar i GeoJSON
            const navn = (feat.properties && (feat.properties.navn || feat.properties.name || feat.properties.NAVN)) || 'Fylke';
            const areal = areaByName[navn] || '‚Äì';
            layer.bindPopup(`<b>${navn}</b><br/>Areal: ${areal}`);
            layer.on('click', () => {
              // Zoom litt inn p√• valgt fylke
              try { map.fitBounds(layer.getBounds(), {maxZoom: 8, padding:[20,20]}); } catch(e){}
              layer.openPopup();
            });
          }
        }).addTo(borderLayer);
        borderLayer.addTo(map);
      })
      .catch(err => console.error('Klarte ikkje laste fylkesgrenser:', err));

    // S√∏k i listene
    const q = document.getElementById('q');
    q.addEventListener('input', ()=>{
      const val = q.value.trim().toLowerCase();
      for(const box of [countyList, cityList]){
        Array.from(box.children).forEach(item=>{
          const text = item.firstChild.textContent.toLowerCase();
          item.style.display = !val || text.includes(val) ? '' : 'none';
        });
      }
    });

    // Knapp-handtering
    document.getElementById('fitNO').addEventListener('click', fitNorway);
    let citiesOn = true, countiesOn = true, bordersOn = true;

    document.getElementById('toggleCities').addEventListener('click', ()=>{
      citiesOn = !citiesOn; if(citiesOn) cityLayer.addTo(map); else map.removeLayer(cityLayer);
    });

    document.getElementById('toggleCounties').addEventListener('click', ()=>{
      countiesOn = !countiesOn; if(countiesOn) countyLayer.addTo(map); else map.removeLayer(countyLayer);
    });

    document.getElementById('toggleBorders').addEventListener('click', ()=>{
      bordersOn = !bordersOn; if(bordersOn) borderLayer.addTo(map); else map.removeLayer(borderLayer);
    });
  </script>
</body>
</html>
